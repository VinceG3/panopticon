#!/usr/bin/env ruby
require 'thor'
require './lib/panopticon'

args = ARGV.clone
if ARGV.include?('-p')
  args.delete('-p')
  require "readline"
  Readline.input = IO.new(IO.sysopen("/dev/tty", "r+"))
  ARGV.clear
  $config = ARGF.read
end

class Command < Thor
  desc "daemonize", "run daemonized"
  def daemonize
    Panopticon.daemonize($config)
  end

  desc "console", "run in console"
  def console
    Panopticon.console($config)
  end

  desc "stop", "stop service"
  def stop
    Panopticon.stop
  end
end

Command.start(args)
